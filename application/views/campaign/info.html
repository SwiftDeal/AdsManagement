{include publisher/modals/link.html}
<div class="row">
    <div class="col-sm-12">
        <h4 class="page-title text-center">{echo $ad->title}</h4>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="card-box">
            <div class="row">
                <div class="col-md-6">
                    <p class="text-center">
                        <img src="{echo Ad::displayImg($ad->image)}" alt="" width="300">
                    </p>
                    <p class="text-center">
                        <a href="{echo $ad->url}" target="_blank" class="btn btn-default waves-effect waves-light">View Landing Page</a> {script $id = $ad->_id}
                        {if($ad->live)}
                        <div class="text-center">
                            <button type="button" data-adid="{echo $ad->_id}" class="createLink btn btn-purple waves-effect waves-light">Generate Link</button>
                        </div>
                        {/if}
                    </p>
                </div>
                <div class="col-md-6">
                    <table class="table">
                        <tbody>
                            <tr>
                                {if($commission["model"] == $c->model)}
                                    {script $rate = $commission["rate"]}
                                {/if} {else}
                                    {script $rate = $c->rate}
                                {/else}
                                <th>Model</th>
                                <td>
                                    {echo $user->convert($rate)} <b>{echo strtoupper($c->model)}</b>
                                    <br>
                                    <small>{echo $c->description}</small>
                                </td>
                            </tr>
                            <tr>
                                <th>Description</th>
                                <td>{echo $ad->description}</td>
                            </tr>
                            <tr>
                                <th>Category</th>
                                
                                <!-- find cat from DB -->
                                {script $results = \Category::all(['_id' => ['$in' => $ad->getCategories()]], ['name'])}
                                {script $categories = []}
                                
                                {foreach $r in $results}
                                    {script $categories[] = $r->name}
                                {/foreach}
                                <td>{echo implode(", ", $categories)}</td>
                            </tr>
                            {script $link = Link::first(["ad_id = ?" => $ad->_id, "user_id = ?" => $user->id])} {if ($link)}
                            <tr>
                                <th>Tracking Link</th>
                                <td id="trackingURL">{echo $link->getUrl()}</td>
                            </tr>
                            <tr>
                                <th>Tracking Params</th>
                                <td class="input-group">
                                    <input type="text" placeholder="Extra Param1" class="form-control" id="param1">
                                    <span class="input-group-addon">,</span>
                                    <input type="text" placeholder="Extra Param2" class="form-control" id="param2">
                                    <span class="input-group-btn">
                                        <button type="button" id="extraParam" class="btn btn-primary">GO</button>
                                    </span>
                                </td>
                            </tr>
                            <script>
                                window.trackingURL = '{echo $link->getUrl()}';
                            </script>
                            {/if}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $('#extraParam').on('click', function (e) {
        e.preventDefault();

        var uri = trackingURL + "?p1=" + $('#param1').val() + "&p2=" + $('#param2').val();
        $('#trackingURL').html(uri);
    });
</script>
